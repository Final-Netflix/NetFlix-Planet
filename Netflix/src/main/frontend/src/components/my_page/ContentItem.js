import axios from 'axios';
import React, { useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import profile from 'stores/profile';

const ContentItem = ({item , date, type, l_type ,profile_id}) => {
    const navigate =useNavigate();
    const qs = require('qs')
    const [isShow1, setIsShow1] = useState(false)
    const [isShow2, setIsShow2] = useState(false)
    const [isShow3, setIsShow3] = useState(false)
    const [subject , setSubject] = useState('');
    function convertDate(mill) {
        const data = new Date(mill);
        
        const year = data.getFullYear();
        const month = data.getMonth() + 1;
        const date = data.getDate();
        
        return `${year}.${month}.${date}`;
      }
    const KEY = "bc61587b22cd0e5226a33d30e467d867";
    //제목 불러오기
    const getSubject = async()=> {
        const json = await(
            await fetch(
                `https://api.themoviedb.org/3/${type}/${item}?api_key=${ KEY }&language=ko-KR`
                )).json();
                if(type==='movie') {
                    setSubject(json.title);
                }else{
                    setSubject(json.name);
                }
                
    }
    //좋아요 불러온 값으로 체크 해두기
    const checkLike = ()=>{
        if(l_type ===1) {
        setIsShow1(true)
        }else if(l_type===2) {
            setIsShow2(true)
        }else {
            setIsShow3(true)
        }
        
    }
    
    const onToggle1 = () => {
        
        axios({
            method :'post',
            url: '/changeLike',
            data : qs.stringify({
                'profile_id' :  profile_id,
                'like_type' : 1,
                'video_id' : item,

            })
        }).then(()=>{
            window.location.reload()
            // setIsShow1(!isShow1)
            // setIsShow2(false)
            // setIsShow3(false)
        })
    }
    const onToggle2 = () => {
        axios({
            method :'post',
            url: '/changeLike',
            data : qs.stringify({
                'profile_id' :  profile_id,
                'like_type' : 2,
                'video_id' : item,

            })
        }).then(()=>{
            window.location.reload()
            // setIsShow2(!isShow2)
            // setIsShow1(false)
            // setIsShow3(false)

        })
    }
    const onToggle3 = () => {
        axios({
            method :'post',
            url: '/changeLike',
            data : qs.stringify({
                'profile_id' :  profile_id,
                'like_type' : 3,
                'video_id' : item,

            })
        }).then(()=>{
            window.location.reload()
            // setIsShow3(!isShow3)
            // setIsShow2(false)
            // setIsShow1(false)

        })
        
    }
    useEffect(()=>{
        getSubject();
        checkLike();
    },[])


    return (
        <>
            <div className="border-solid my-[12px] border-t-[1px] h-1 border-neutral-300 w-[100%]"></div> 
                <ul>
                    <li>
                        <div className = "flex justify-start w-full relative">
                            <div className = "flex pl-3">
                                <div className = "text-xl">{convertDate(date)}</div>
                                <a className = "ml-20 text-xl w-[860px] text-[#0080ff]">{subject}</a>
                            </div>
                            <svg onClick = { onToggle1 } width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className=" ml-5 relative Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M13.304 15.2268C13.1053 15.5447 13 15.912 13 16.2868V20H12.1623C11.2848 20 10.5715 19.4471 10.3927 18.6887C10.1767 17.7724 10 16.7728 10 16C10 15.4152 10.1024 14.8081 10.2464 14.2496L10.5685 13H9.27807H6.5C5.67157 13 5 12.3284 5 11.5C5 11.4071 5.00833 11.3169 5.02404 11.2301L5.10454 10.7851L4.82357 10.4308C4.6206 10.1748 4.5 9.85286 4.5 9.5C4.5 9.14714 4.6206 8.82521 4.82357 8.56924L5.10454 8.2149L5.02405 7.76991C5.00833 7.68305 5 7.59293 5 7.5C5 7.0099 5.23399 6.57474 5.60058 6.29938L5.99996 5.99939L6 5.49989C6.00006 4.67151 6.67161 4 7.5 4H10H11H11.3772C12.3446 4 13.3056 4.15595 14.2233 4.46185L15.7163 4.95954C16.7754 5.31257 17.8838 5.49494 19 5.4999V10.2457L16.9644 10.8273C16.2507 11.0312 15.638 11.4924 15.2446 12.1219L13.304 15.2268ZM13.5 22C14.3284 22 15 21.3284 15 20.5V16.2868L16.9406 13.1819C17.0717 12.9721 17.276 12.8183 17.5139 12.7503L19.5494 12.1687C20.408 11.9234 21 11.1387 21 10.2457V5.45319C21 4.37447 20.1255 3.5 19.0468 3.5C18.1298 3.5 17.2188 3.35216 16.3488 3.06217L14.8557 2.56448C13.7341 2.19061 12.5595 2 11.3772 2H11H10H7.5C5.73076 2 4.26812 3.31275 4.03301 5.01735C3.39612 5.65042 3 6.52905 3 7.5C3 7.56309 3.00168 7.62585 3.005 7.68825C2.6847 8.21698 2.5 8.83782 2.5 9.5C2.5 10.1622 2.6847 10.783 3.005 11.3117C3.00168 11.3742 3 11.4369 3 11.5C3 13.433 4.567 15 6.5 15H8.06624C8.02476 15.3245 8 15.6603 8 16C8 17.0114 8.22123 18.1939 8.44607 19.1476C8.85988 20.903 10.4572 22 12.1623 22H13.5Z" fill="currentColor"></path>
                                { isShow1 &&
                                        <svg  width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M10.593 17.7442L10.687 18.4959C10.8658 19.9265 12.0819 21 13.5236 21C13.7867 21 14 20.7867 14 20.5236V17.2868C14 17.0994 14.0527 16.9157 14.152 16.7568L16.0926 13.6519C16.3548 13.2323 16.7633 12.9248 17.2391 12.7888L19.2747 12.2072C19.704 12.0846 20 11.6922 20 11.2457V5.68387C20 5.30618 19.6938 5 19.3161 5C18.126 5 16.9565 4.68942 15.9232 4.09895L15.75 4C14.6032 3.34469 13.3053 3 11.9844 3H11H8H7.5C6.67157 3 6 3.67157 6 4.5C6 4.88418 6.14443 5.23462 6.38195 5.5H6C5.17157 5.5 4.5 6.17157 4.5 7C4.5 7.53991 4.78525 8.0132 5.21328 8.27737C4.522 8.41118 4 9.01963 4 9.75C4 10.5784 4.67157 11.25 5.5 11.25H5.67055C5.26638 11.5187 5 11.9783 5 12.5C5 13.3284 5.67157 14 6.5 14H10.875L10.593 16.2558C10.5312 16.75 10.5312 17.25 10.593 17.7442Z" fill="currentColor"></path></svg>    }
                            </svg>
                            
                            <svg onClick = { onToggle2 } width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className=" ml-5 relative Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M10.696 8.7732C10.8947 8.45534 11 8.08804 11 7.7132V4H11.8377C12.7152 4 13.4285 4.55292 13.6073 5.31126C13.8233 6.22758 14 7.22716 14 8C14 8.58478 13.8976 9.1919 13.7536 9.75039L13.4315 11H14.7219H17.5C18.3284 11 19 11.6716 19 12.5C19 12.5929 18.9917 12.6831 18.976 12.7699L18.8955 13.2149L19.1764 13.5692C19.3794 13.8252 19.5 14.1471 19.5 14.5C19.5 14.8529 19.3794 15.1748 19.1764 15.4308L18.8955 15.7851L18.976 16.2301C18.9917 16.317 19 16.4071 19 16.5C19 16.9901 18.766 17.4253 18.3994 17.7006L18 18.0006L18 18.5001C17.9999 19.3285 17.3284 20 16.5 20H14H13H12.6228C11.6554 20 10.6944 19.844 9.77673 19.5382L8.28366 19.0405C7.22457 18.6874 6.11617 18.5051 5 18.5001V13.7543L7.03558 13.1727C7.74927 12.9688 8.36203 12.5076 8.75542 11.8781L10.696 8.7732ZM10.5 2C9.67157 2 9 2.67157 9 3.5V7.7132L7.05942 10.8181C6.92829 11.0279 6.72404 11.1817 6.48614 11.2497L4.45056 11.8313C3.59195 12.0766 3 12.8613 3 13.7543V18.5468C3 19.6255 3.87447 20.5 4.95319 20.5C5.87021 20.5 6.78124 20.6478 7.65121 20.9378L9.14427 21.4355C10.2659 21.8094 11.4405 22 12.6228 22H13H14H16.5C18.2692 22 19.7319 20.6873 19.967 18.9827C20.6039 18.3496 21 17.4709 21 16.5C21 16.4369 20.9983 16.3742 20.995 16.3118C21.3153 15.783 21.5 15.1622 21.5 14.5C21.5 13.8378 21.3153 13.217 20.995 12.6883C20.9983 12.6258 21 12.5631 21 12.5C21 10.567 19.433 9 17.5 9H15.9338C15.9752 8.6755 16 8.33974 16 8C16 6.98865 15.7788 5.80611 15.5539 4.85235C15.1401 3.09702 13.5428 2 11.8377 2H10.5Z" fill="currentColor"></path>
                                { isShow2 &&
                                        <svg  width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="ml-7 absolute Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M13.407 6.25579L13.313 5.50407C13.1342 4.07353 11.9181 3 10.4764 3C10.2133 3 10 3.21331 10 3.47644V6.7132C10 6.90062 9.94733 7.08427 9.848 7.2432L7.90742 10.3481C7.64516 10.7677 7.23665 11.0752 6.76086 11.2112L4.72528 11.7928C4.29598 11.9154 4 12.3078 4 12.7543V18.3161C4 18.6938 4.30618 19 4.68387 19C5.874 19 7.04352 19.3106 8.07684 19.9011L8.25 20C9.39679 20.6553 10.6947 21 12.0156 21H13H16H16.5C17.3284 21 18 20.3284 18 19.5C18 19.1158 17.8556 18.7654 17.6181 18.5H18C18.8284 18.5 19.5 17.8284 19.5 17C19.5 16.4601 19.2147 15.9868 18.7867 15.7226C19.478 15.5888 20 14.9804 20 14.25C20 13.4216 19.3284 12.75 18.5 12.75H18.3294C18.7336 12.4813 19 12.0217 19 11.5C19 10.6716 18.3284 10 17.5 10H13.125L13.407 7.74421C13.4688 7.24999 13.4688 6.75001 13.407 6.25579Z" fill="currentColor"></path></svg>
                                    }
                            </svg>
                            
                            <svg onClick = { onToggle3 } width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className=" ml-5 relative Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M13.5 2V5.76393C13.5 6.07442 13.4277 6.38065 13.2889 6.65836L12.7708 7.69437C12.6876 7.22319 12.5917 6.77987 12.5006 6.39344C12.31 5.5852 11.9615 4.87278 11.5 4.2696V1.5C11.5 0.671574 12.1716 0 13 0H14.3377C16.0428 0 17.6401 1.09702 18.0539 2.85235C18.2788 3.80611 18.5 4.98865 18.5 6C18.5 6.33974 18.4752 6.6755 18.4338 7H20C21.933 7 23.5 8.567 23.5 10.5C23.5 10.5631 23.4983 10.6258 23.495 10.6883C23.8153 11.217 24 11.8378 24 12.5C24 13.1622 23.8153 13.783 23.495 14.3118C23.4983 14.3742 23.5 14.4369 23.5 14.5C23.5 15.4709 23.1039 16.3496 22.467 16.9827C22.2319 18.6873 20.7692 20 19 20H17.7925C17.9004 19.6191 17.9683 19.2213 17.9913 18.8115C18.1119 18.5513 18.2129 18.2801 18.2922 18H19C19.8284 18 20.4999 17.3285 20.5 16.5001L20.5 16.0006L20.8994 15.7006C21.266 15.4253 21.5 14.9901 21.5 14.5C21.5 14.4071 21.4917 14.317 21.476 14.2301L21.3955 13.7851L21.6764 13.4308C21.8794 13.1748 22 12.8529 22 12.5C22 12.1471 21.8794 11.8252 21.6764 11.5692L21.3955 11.2149L21.476 10.7699C21.4917 10.6831 21.5 10.5929 21.5 10.5C21.5 9.67157 20.8284 9 20 9H17.2219H15.9315L16.2536 7.75039C16.3976 7.1919 16.5 6.58478 16.5 6C16.5 5.22716 16.3233 4.22758 16.1073 3.31126C15.9285 2.55292 15.2152 2 14.3377 2H13.5ZM6 9.76393V6H6.83772C7.71518 6 8.42852 6.55292 8.60729 7.31126C8.82331 8.22758 9 9.22716 9 10C9 10.5848 8.89755 11.1919 8.75359 11.7504L8.43147 13H9.72193H12.5C13.3284 13 14 13.6716 14 14.5C14 14.5929 13.9917 14.6831 13.976 14.7699L13.8955 15.2149L14.1764 15.5692C14.3794 15.8252 14.5 16.1471 14.5 16.5C14.5 16.8529 14.3794 17.1748 14.1764 17.4308L13.8955 17.7851L13.976 18.2301C13.9917 18.317 14 18.4071 14 18.5C14 18.9901 13.766 19.4253 13.3994 19.7006L13 20.0006L13 20.5001C12.9999 21.3285 12.3284 22 11.5 22H9H8H7.90394C6.78317 22 5.67407 21.7724 4.64392 21.3309L3.82098 20.9782C3.24116 20.7297 2.62633 20.576 2 20.5219V15.618L2.85093 15.1926C3.43151 14.9023 3.90228 14.4315 4.19257 13.8509L5.78885 10.6584C5.92771 10.3806 6 10.0744 6 9.76393ZM5.5 4C4.67157 4 4 4.67157 4 5.5V9.76393L2.40372 12.9565C2.30695 13.15 2.15003 13.307 1.9565 13.4037L1.10557 13.8292C0.428005 14.168 0 14.8605 0 15.618V21.0086C0 21.8323 0.667718 22.5 1.49139 22.5C2.02143 22.5 2.54595 22.6077 3.03314 22.8165L3.85608 23.1691C5.13519 23.7173 6.51232 24 7.90394 24H8H9H11.5C13.2692 24 14.7319 22.6873 14.967 20.9827C15.6039 20.3496 16 19.4709 16 18.5C16 18.4369 15.9983 18.3742 15.995 18.3118C16.3153 17.783 16.5 17.1622 16.5 16.5C16.5 15.8378 16.3153 15.217 15.995 14.6883C15.9983 14.6258 16 14.5631 16 14.5C16 12.567 14.433 11 12.5 11H10.9338C10.9752 10.6755 11 10.3397 11 10C11 8.98865 10.7788 7.80611 10.5539 6.85235C10.1401 5.09702 8.54284 4 6.83772 4H5.5Z" fill="currentColor"></path>
                                { isShow3 &&
                                        <svg  width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="Hawkins-Icon Hawkins-Icon-Standard"><path fillRule="evenodd" clipRule="evenodd" d="M17.313 2.50407L17.407 3.25579C17.4688 3.75001 17.4688 4.24999 17.407 4.74421L17.125 7H21.5C22.3284 7 23 7.67157 23 8.5C23 9.02174 22.7336 9.48127 22.3295 9.75H22.5C23.3284 9.75 24 10.4216 24 11.25C24 11.9804 23.478 12.5888 22.7867 12.7226C23.2148 12.9868 23.5 13.4601 23.5 14C23.5 14.8284 22.8284 15.5 22 15.5H21.6181C21.8556 15.7654 22 16.1158 22 16.5C22 17.3284 21.3284 18 20.5 18H20H17.9195C17.9722 17.7585 18 17.5075 18 17.25C18 16.2903 17.6138 15.4209 16.9883 14.7886C16.996 14.6934 17 14.5972 17 14.5C17 12.567 15.433 11 13.5 11H11.3906L11.3915 10.9923C11.4739 10.3333 11.4739 9.66668 11.3915 9.00772L11.2976 8.256L10.0645 8.41013L11.2976 8.256C11.2865 8.16745 11.2731 8.0797 11.2574 7.99281C11.519 7.83232 11.7422 7.61247 11.9074 7.34813L13.848 4.2432C13.9473 4.08427 14 3.90062 14 3.7132V0.47644C14 0.21331 14.2133 0 14.4764 0C15.9181 0 17.1342 1.07353 17.313 2.50407ZM9.31301 8.50407L9.40697 9.25579C9.46875 9.75001 9.46875 10.25 9.40697 10.7442L9.125 13H13.5C14.3284 13 15 13.6716 15 14.5C15 15.0217 14.7336 15.4813 14.3294 15.75H14.5C15.3284 15.75 16 16.4216 16 17.25C16 17.9804 15.478 18.5888 14.7867 18.7226C15.2147 18.9868 15.5 19.4601 15.5 20C15.5 20.8284 14.8284 21.5 14 21.5H13.6181C13.8556 21.7654 14 22.1158 14 22.5C14 23.3284 13.3284 24 12.5 24H12H9H8.01556C6.69475 24 5.39679 23.6553 4.25 23L4.07684 22.9011C3.04352 22.3106 1.874 22 0.683874 22C0.306181 22 0 21.6938 0 21.3161V15.7543C0 15.3078 0.295977 14.9154 0.725279 14.7928L2.76086 14.2112C3.23665 14.0752 3.64516 13.7677 3.90742 13.3481L5.848 10.2432C5.94733 10.0843 6 9.90062 6 9.7132V6.47644C6 6.21331 6.21331 6 6.47644 6C7.91812 6 9.13419 7.07353 9.31301 8.50407Z" fill="currentColor"></path></svg>
                                    }
                            </svg>
                        </div>
                    </li>
                </ul>
        </>
    );
};

export default ContentItem;